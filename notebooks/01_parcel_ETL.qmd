---
title: "NC Parcel Data Sanity Checks"
author: "Russell Blessing"
format:
  html:
    toc: true
    theme: cosmo
    code-fold: true
    code-summary: "Show / hide code"
execute:
  echo: true
  message: true
  warning: false
---

## Load libraries

```{r}
library(sf)
library(dplyr)
library(ggplot2)
library(knitr)
```

## Point to directories and data

```{r}
# Output directory (external to repo; not tracked by git)
out_dir <- "/proj/mhinolab/users/rbless/data/Obstacles_Output"
dir.create(out_dir, recursive = TRUE, showWarnings = FALSE)

out_gpkg <- file.path(out_dir, "parcels_study_area.gpkg")
out_csv  <- file.path(out_dir, "parcels_study_area.csv")

study_area_path <- "/proj/mhinolab/projects/obstacles/NC_huc6_data_union_sf/NC_huc6_data_union_sf.shp"
gpkg_path <- "/proj/mhinolab/users/rbless/data/parcels/NC_Parcels_all.gpkg"
parcels_layer <- "nc_parcels_poly" # update if st_layers() indicates otherwise
```

## Study Area
```{r}
study_area <- st_read(study_area_path, quiet = TRUE)

study_union <- study_area |>
st_make_valid() |>
st_union()

ggplot() +
geom_sf(data = study_union, fill = "lightblue", color = "darkblue") +
theme_minimal() +
labs(title = "Study Area Boundary")

```
## Identify parcel CRS

```{r}
parcels_1 <- st_read(
gpkg_path,
layer = parcels_layer,
n_max = 1,
quiet = TRUE
)

parcel_crs <- st_crs(parcels_1)
parcel_crs

```